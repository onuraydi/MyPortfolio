@model List<GetAllPortfolioBlogDto>


<div class="search-container">
    <input type="text" id="searchInput" placeholder="Blogları arayın..." onkeyup="searchBlogs()">
    <div id="searchResults" class="search-results"></div>
</div>
<div id="blogContainer"></div>


<style>
    .search-container {
        position: relative;
        margin-bottom: 20px;
    }

    #searchInput {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        box-sizing: border-box;
    }

    .search-results {
        position: absolute;
        top: 40px;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        max-height: 300px;
        overflow-y: auto;
        z-index: 1000;
    }

    .no-results {
        padding: 10px;
        color: #777;
    }

    .blog-post {
        border-bottom: 1px solid #ddd;
        padding: 10px;
        cursor: pointer;
    }

        .blog-post h2 {
            margin: 0;
            font-size: 18px;
        }

        .blog-post p {
            margin: 5px 0;
        }

        .blog-post .tags {
            margin-top: 5px;
        }

            .blog-post .tags span {
                display: inline-block;
                background: #eee;
                border: 1px solid #ccc;
                padding: 2px 5px;
                margin-right: 5px;
                font-size: 12px;
                border-radius: 3px;
            }
</style>
<meta charset="utf-8">
<script>
const blogs = [];

@foreach (var blog in Model)
{
    <text>
    blogs.push({
        PortfolioBlogId: @blog.PortfolioBlogId,
        Title: "@blog.Title",
        SubContent: "@blog.SubContent",
        Content: "@blog.Content",
        CoverImage: "@blog.CoverImage",
        PublishDate: new Date("@blog.PublishDate"),
        PortfolioBlogTags: [
            @foreach (var tag in blog.PortfolioBlogTags)
            {
                <text>
                { Name: "@tag.TagName" },
                </text>
            }
        ]
    });
    </text>
}

document.addEventListener('click', function(event) {
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    if (!searchInput.contains(event.target) && !searchResults.contains(event.target)) {
        searchResults.style.display = 'none';
    }
});

function decodeHtmlEntities(str) {
    if (!str) return '';
    const textarea = document.createElement('textarea');
    textarea.innerHTML = str;
    return textarea.value;
}

function normalizeTurkish(text) {
    if (!text) return '';
    const decodedText = decodeHtmlEntities(text);
    return decodedText
        .toLowerCase()
        .replace(/ı/g, 'i')
        .replace(/ğ/g, 'g')
        .replace(/ü/g, 'u')
        .replace(/ş/g, 's')
        .replace(/ö/g, 'o')
        .replace(/ç/g, 'c')
        .replace(/İ/g, 'i')
        .replace(/Ğ/g, 'g')
        .replace(/Ü/g, 'u')
        .replace(/Ş/g, 's')
        .replace(/Ö/g, 'o')
        .replace(/Ç/g, 'c');
}

function searchBlogs() {
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const searchText = searchInput.value.trim();
    const normalizedSearchText = normalizeTurkish(searchText);


    if (!searchText) {
        searchResults.innerHTML = '';
        searchResults.style.display = 'none';
        return;
    }

    const results = [];
    
    for (let i = 0; i < blogs.length; i++) {
        const blog = blogs[i];
        const normalizedTitle = normalizeTurkish(blog.Title || '');
        const normalizedSubContent = normalizeTurkish(blog.SubContent || '');
        

        // Başlıkta ara
        if (normalizedTitle.indexOf(normalizedSearchText) !== -1) {
            results.push(blog);
            continue;
        }
        
        // Alt içerikte ara
        if (normalizedSubContent.indexOf(normalizedSearchText) !== -1) {
            results.push(blog);
            continue;
        }
        
        // Etiketlerde ara
        for (let j = 0; j < blog.PortfolioBlogTags.length; j++) {
            const tag = blog.PortfolioBlogTags[j];
            const normalizedTag = normalizeTurkish(tag.Name || '');
            
            if (normalizedTag.indexOf(normalizedSearchText) !== -1) {
                results.push(blog);
                break;
            }
        }
    }

    displayResults(results);
}

function displayResults(results) {
    const searchResults = document.getElementById('searchResults');
    searchResults.innerHTML = '';
    searchResults.style.display = 'block';

    if (results.length === 0) {
        const noResults = document.createElement('div');
        noResults.className = 'no-results';
        noResults.textContent = 'Aradığınız blog bulunamadı.';
        searchResults.appendChild(noResults);
        return;
    }

    for (let i = 0; i < results.length; i++) {
        const blog = results[i];
        const blogDiv = document.createElement('div');
        blogDiv.className = 'blog-post';
        
        const title = blog.Title || 'Başlık Bulunamadı';
        const subContent = blog.SubContent || 'Alt Başlık Bulunamadı';
        const date = blog.PublishDate ? 
            blog.PublishDate.toLocaleDateString('tr-TR', { year: 'numeric', month: 'long', day: 'numeric' }) : 
            'Tarih Bulunamadı';
        
        let tags = 'Etiket Bulunamadı';
        if (blog.PortfolioBlogTags && blog.PortfolioBlogTags.length > 0) {
            tags = blog.PortfolioBlogTags.map(tag => `<span>${tag.Name}</span>`).join('');
        }

        blogDiv.innerHTML = `
            <h2 style="color:black">${title}</h2>
            <p>${subContent}</p>
            <p>Tarih: ${date}</p>
            <div class="tags">${tags}</div>
        `;

        blogDiv.addEventListener('click', () => {
            window.location.href = `https://localhost:7006/BlogDetail/GetBlogDetail/${blog.PortfolioBlogId}`;
        });

        searchResults.appendChild(blogDiv);
    }
}

// Arama kutusuna her yazıldığında arama yap
document.getElementById('searchInput').addEventListener('input', searchBlogs);
</script>
